<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="page-title">Search Results</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background: #f2f4f8;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }

    .header h1 {
      font-size: 32px;
      color: #1f2a44;
      margin-bottom: 8px;
    }

    .header p {
      font-size: 14px;
      color: #6a7280;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 16px;
      color: #ff8a3d;
      text-decoration: none;
      font-weight: 600;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    .filter-section {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 24px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }

    .filter-section h3 {
      margin-bottom: 12px;
      color: #1f2a44;
      font-size: 16px;
    }

    .sort-options {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .sort-btn {
      padding: 8px 16px;
      border: 2px solid #e5e7eb;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
    }

    .sort-btn:hover,
    .sort-btn.active {
      border-color: #ff8a3d;
      background: #fff5f1;
      color: #ff8a3d;
    }

    .phones-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .phone-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
    }

    .phone-card:hover {
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
      transform: translateY(-4px);
    }

    .phone-image {
      width: 100%;
      height: 200px;
      background: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      color: #ddd;
    }

    .phone-content {
      padding: 16px;
    }

    .phone-name {
      font-size: 16px;
      font-weight: 600;
      color: #1f2a44;
      margin-bottom: 8px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .phone-price {
      font-size: 18px;
      font-weight: 700;
      color: #ff8a3d;
      margin-bottom: 10px;
    }

    .phone-specs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 12px;
    }

    .spec {
      background: #f9fafb;
      padding: 8px;
      border-radius: 4px;
      text-align: center;
    }

    .spec-label {
      color: #6a7280;
      font-size: 11px;
      margin-bottom: 4px;
    }

    .spec-value {
      color: #1f2a44;
      font-weight: 600;
      font-size: 13px;
    }

    .phone-links {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .link-btn {
      padding: 8px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.3s;
      text-decoration: none;
      text-align: center;
    }

    .amazon-btn {
      background: #FF9900;
      color: white;
    }

    .amazon-btn:hover {
      background: #e68a00;
    }

    .flipkart-btn {
      background: #1f42a9;
      color: white;
    }

    .flipkart-btn:hover {
      background: #182d7f;
    }

    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .no-results-icon {
      font-size: 64px;
      margin-bottom: 16px;
    }

    .stats {
      color: #6a7280;
      font-size: 14px;
      margin-top: 16px;
    }

    .rating-badge {
      display: inline-block;
      background: #fff3cd;
      color: #856404;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="/" class="back-link">‚Üê Back to Home</a>
    <a href="/all-brands" class="back-link" style="margin-left: 16px;">‚Üê All Brands</a>

    <div class="header">
      <h1 id="brand-name">Search Results</h1>
      <p id="result-count">Loading results...</p>
    </div>

    <div class="filter-section">
      <h3>Sort By</h3>
      <div class="sort-options">
        <button class="sort-btn active" onclick="sortPhones('price')">Price (Low to High)</button>
        <button class="sort-btn" onclick="sortPhones('price-desc')">Price (High to Low)</button>
        <button class="sort-btn" onclick="sortPhones('rating')">Rating</button>
        <button class="sort-btn" onclick="sortPhones('gaming')">Gaming Score</button>
        <button class="sort-btn" onclick="sortPhones('camera')">Camera Score</button>
        <button class="sort-btn" onclick="sortPhones('battery')">Battery Score</button>
      </div>
    </div>

    <div class="phones-grid" id="phonesGrid">
      <!-- Populated by JavaScript -->
    </div>
  </div>

  <script>
    let allPhones = [];
    let currentSort = 'price';

    async function loadPhones() {
      const urlParams = new URLSearchParams(window.location.search);
      const query = urlParams.get('q') || 'phone';
      const maxPrice = urlParams.get('max_price');

      try {
        let url = `/api/search?q=${encodeURIComponent(query)}&limit=200`;
        if (maxPrice) {
          url += `&max_price=${maxPrice}`;
        }

        const response = await fetch(url);
        const data = await response.json();

        allPhones = data.results || [];

        // Update page title
        document.getElementById('brand-name').textContent = `${query} Phones`;
        document.getElementById('page-title').textContent = `${query} Phones - Top 3 Pick`;
        document.getElementById('result-count').textContent = `Found ${allPhones.length} phones`;

        renderPhones();
      } catch (error) {
        console.error('Error loading phones:', error);
        document.getElementById('phonesGrid').innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999; padding: 40px;">Error loading phones</p>';
      }
    }

    function sortPhones(sortType) {
      currentSort = sortType;

      // Update button states
      document.querySelectorAll('.sort-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      renderPhones();
    }

    function getSortedPhones() {
      let sorted = [...allPhones];

      if (currentSort === 'price') {
        sorted.sort((a, b) => a.price - b.price);
      } else if (currentSort === 'price-desc') {
        sorted.sort((a, b) => b.price - a.price);
      } else if (currentSort === 'rating') {
        sorted.sort((a, b) => {
          const avgA = (a.gaming + a.camera + a.battery + a.performance) / 4;
          const avgB = (b.gaming + b.camera + b.battery + b.performance) / 4;
          return avgB - avgA;
        });
      } else {
        sorted.sort((a, b) => (b[currentSort] || 0) - (a[currentSort] || 0));
      }

      return sorted;
    }

    function renderPhones() {
      const grid = document.getElementById('phonesGrid');
      grid.innerHTML = '';

      const sorted = getSortedPhones();

      if (sorted.length === 0) {
        grid.innerHTML = '<div style="grid-column: 1/-1;"><div class="no-results"><div class="no-results-icon">üì±</div><h3>No phones found</h3><p>Try adjusting your search criteria</p></div></div>';
        return;
      }

      sorted.forEach(phone => {
        const avgRating = ((phone.gaming || 5) + (phone.camera || 5) + (phone.battery || 5) + (phone.performance || 5)) / 4;
        
        const card = document.createElement('div');
        card.className = 'phone-card';
        card.innerHTML = `
          <div class="phone-image">üì±</div>
          <div class="phone-content">
            <div class="phone-name">${phone.name}</div>
            ${phone.company ? `<div style="font-size: 12px; color: #6a7280; margin-bottom: 8px;">${phone.company}</div>` : ''}
            <div class="phone-price">‚Çπ${phone.price.toLocaleString()}</div>
            
            <div class="phone-specs">
              <div class="spec">
                <div class="spec-label">Gaming</div>
                <div class="spec-value">${phone.gaming || 5}/10</div>
              </div>
              <div class="spec">
                <div class="spec-label">Camera</div>
                <div class="spec-value">${phone.camera || 5}/10</div>
              </div>
              <div class="spec">
                <div class="spec-label">Battery</div>
                <div class="spec-value">${phone.battery || 5}/10</div>
              </div>
              <div class="spec">
                <div class="spec-label">Performance</div>
                <div class="spec-value">${phone.performance || 5}/10</div>
              </div>
            </div>

            ${phone.reason ? `<div style="font-size: 12px; color: #6a7280; margin-bottom: 12px; font-style: italic;">"${phone.reason}"</div>` : ''}

            <div class="phone-links">
              <a href="${phone.amazon || '#'}" target="_blank" class="link-btn amazon-btn">Amazon</a>
              <a href="${phone.flipkart || '#'}" target="_blank" class="link-btn flipkart-btn">Flipkart</a>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    // Load phones on page load
    loadPhones();
  </script>
</body>
</html>
